---
title: "Metamaskã§ãƒ­ã‚°ã‚¤ãƒ³&ãƒ•ãƒ­ãƒ³ãƒˆã‚¢ãƒ—ãƒªã‹ã‚‰NFTã‚’ç™ºè¡Œã™ã‚‹"
type: "tech"
topics: ["ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³","openzeppelin","infura","nft","solidity"]
published: false
emoji: "ğŸ‘»"
published_at: 2022-01-28 12:00
---
:::message alert
ã“ã®è¨˜äº‹ã«å®Ÿè£…æ¼ã‚ŒãŒã‚ã‚‹ãŸã‚ã€ã†ã¾ãå‹•ã‹ãªã„ã“ã¨ãŒã‚ã‚‹ã‚ˆã†ã§ã™ã€‚ãã®éš›ã¯ã‚µãƒ³ãƒ—ãƒ«ãƒªãƒã‚¸ãƒˆãƒªã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚
:::

å‰å›ã¯ã€[NFTã‚’ç™ºè¡Œã™ã‚‹ç‹¬è‡ªã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’Infuraã®ãƒ†ã‚¹ãƒˆãƒãƒƒãƒˆï¼ˆRopstenï¼‰ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹](https://zenn.dev/takuya911/articles/a88381b32f35a9)ã¨ã“ã‚ã¾ã§ã‚„ã‚Šã¾ã—ãŸã€‚
ã‚‚ã—ã¾ã ã‚„ã£ã¦ãªã„äººã¯å‰å›æ›¸ã„ãŸè¨˜äº‹ã‹ã‚‰ã‚„ã£ã¦ãã ã•ã„ã€‚

ã“ã®è¨˜äº‹ã§ã¯ã€ãƒ­ãƒ¼ã‚«ãƒ«ã‹ã‚‰ãã®ã‚¹ãƒã‚³ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€NFTã‚’ç™ºè¡Œã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚

## å¿…è¦ãªã‚‚ã®

- Node
- Metamask
  - ropstenãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®æ®‹é«˜ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚ç„¡æ–™é…å¸ƒã—ã¦ãã‚Œã¦ã„ã‚‹ã‚µã‚¤ãƒˆãŒã„ãã¤ã‹ã‚ã‚‹ã®ã§ã€ãã“ã‹ã‚‰ã‚¯ãƒ¬ã‚¯ãƒ¬ã—ã¦ãŠã„ã¦ãã ã•ã„ã€‚
    - <https://faucet.ropsten.be/>
- Ropstenãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ETHæ®‹é«˜

## å‡ºæ¥ä¸ŠãŒã‚Š

ä»¥ä¸‹ãƒªãƒã‚¸ãƒˆãƒªã«ãƒ‡ãƒ—ãƒ­ã‚¤ã¾ã§è¡Œã£ãŸã‚³ãƒ¼ãƒ‰ã‚’å…¥ã‚Œã¦ã‚ã‚Šã¾ã™ã€‚
<https://github.com/tkyatg/nft-front-example>

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ

Nuxtã‚¢ãƒ—ãƒªã§é€²ã‚ã¦ã„ãã¾ã™ã€‚Reactè§¦ã£ãŸã“ã¨ãªã„ã®ã§ã€ãŠè¨±ã—ã‚’ã€‚

```sol
$ npx create-nuxt-app
Need to install the following packages:
  create-nuxt-app
Ok to proceed? (y) y

create-nuxt-app v3.7.1
âœ¨  Generating Nuxt.js project in .
? Project name: nuxt
? Programming language: JavaScript
? Package manager: Yarn
? UI framework: Vuetify.js
? Nuxt.js modules: (Press <space> to select, <a> to toggle all, <i> to invert se
lection)
? Linting tools: (Press <space> to select, <a> to toggle all, <i> to invert sele
ction)
? Testing framework: None
? Rendering mode: Single Page App
? Deployment target: Server (Node.js hosting)
? Development tools: jsconfig.json (Recommended for VS Code if you're not using 
typescript)
? What is your GitHub username? 
? Version control system: None
```

## å®Ÿè£…ã®æº–å‚™

`layouts/default.vue`ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ãæ›ãˆã¾ã™ã€‚
ï¼ˆä¸è¦ã‚³ãƒ¼ãƒ‰ã‚’å‰Šé™¤ã—ãŸã ã‘ã§ã™ï¼‰

```js
<template>
  <v-app>
    <v-main>
      <nuxt />
    </v-main>
  </v-app>
</template>
```

web3jsã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```sol
npm install web3
```

## Metamaskã§ãƒ­ã‚°ã‚¤ãƒ³

`pages/index.vue`ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ãæ›ãˆã¦ã€åˆæœŸè¡¨ç¤ºæ™‚ã«`wallet`ã®æƒ…å ±ã‚’å–å¾—ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

```js
<template>
  <v-container></v-container>
</template>

<script>
import Web3 from "web3";
export default {
  data() {
    return {
      web3: null,
    };
  },
  async created() {
    const web3 = new Web3(this.endpoint);
    this.web3 = web3;
    try {
      const newAccounts = await ethereum.request({
        method: "eth_requestAccounts",
      });
      const accounts = newAccounts;
      if (accounts[0] !== "") {
        this.web3.eth.defaultAccount = accounts[0];
      } else {
        console.error("ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—");
      }
    } catch (error) {
      console.error(error);
    }
  },
};
</script>
```

ã‚¢ãƒ—ãƒªèµ·å‹•

```bash
yarn dev
```

ã‚¢ãƒ—ãƒªèµ·å‹•å¾Œã€`localhost:3000`ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€`Metamask`ã®ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ãŒé–‹ãã¾ã™ã€‚
æ—¢ã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹å ´åˆ&`Metamask`ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„å ´åˆã‚‚ä½•ã‚‚èµ·ãã¾ã›ã‚“ã€‚ï¼ˆã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¯ï¼‰
![image](https://storage.googleapis.com/zenn-user-upload/5bf319cf4502-20220128.png)

## contractã‚¢ã‚¯ã‚»ã‚¹ç”¨ã®ABIã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãã‚‹

å‰å›ä½œæˆã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®`/artifacts/contracts/Nft.sol/Nft.json`ã«ABIãŒä½œæˆã•ã‚Œã¦ã„ã¾ã™ã€‚

> ABIã¨ã¯
>ã‚¤ãƒ¼ã‚µãƒªã‚¢ãƒ ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ å†…ã§ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã«æ¥ç¶šã™ã‚‹ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ãªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®ã“ã¨

ã‚‚ã—ç„¡ã„å ´åˆã¯ä»¥ä¸‹ã‚³ãƒãƒ³ãƒ‰ã§ä½œæˆã§ãã¾ã™ã€‚

```bash
npx hardhat compile
```

hadhatãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®`/artifacts/contracts/Nft.sol/Nft.json`ã®`Nft.json`ã‚’ä»Šå›ã®ã‚¢ãƒ—ãƒªã®`/abi/Nft.json`ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚

## contractã«æ¥ç¶š

`pages/index.vue`ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ç·¨é›†ã—ã¦ã€å¯¾è±¡ã®ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã«æ¥ç¶šã—ã¾ã™ã€‚

```diff sol

  data() {
    return {
      web3: null,
+      nftContract: null,
+      endpoint: "{infura ã® endpoint}",
+      contractAddress: "{infura ã¸ contract deploy ã™ã‚‹æ™‚ã«è¡¨ç¤ºã•ã‚Œã‚‹æ–‡å­—åˆ—}",
    };
  },
  async created() {
    const web3 = new Web3(this.endpoint);
+    const json = require("../abi/Nft.json");
+    const nftContract = new web3.eth.Contract(json.abi, this.contractAddress);
    this.web3 = web3;
+    this.nftContract = nftContract;
    try {
      const newAccounts = await ethereum.request({
        method: "eth_requestAccounts",
      });
```

dataã®éƒ¨åˆ†ã®ã¿ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚

- endpoint
  - infura ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹`https://ropsten.infura.io/v3/...`
- contract address
  - local ã‹ã‚‰ infura ã¸ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸéš›ã« log ã«è¡¨ç¤ºã•ã‚Œã‚‹æ–‡å­—åˆ—

ã“ã®å¤‰æ›´å¾Œã€æ¤œè¨¼ã‚’é–‹ã„ã¦ã€ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã„ãªã‘ã‚Œã°æ¥ç¶šè‡ªä½“ã¯æˆåŠŸã—ã¦ã„ã¾ã™ã€‚

## NFTä½œæˆã‚³ãƒ¼ãƒ‰ã®è¿½è¨˜

å®Ÿéš›ã«NFTã‚’ä½œã£ã¦ã¿ã¾ã™ã€‚
NFTä½œæˆã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’`pages/index.vue`ã«è¿½è¨˜ã—ã¾ã™ã€‚

```diff sol
ã€€<template>
  <v-container>
+    <v-row>
+      <v-col cols="12">
+        <v-card>
+          <v-list-item>
+            <v-list-item-title> NFTä½œæˆ </v-list-item-title>
+          </v-list-item>
+          <v-list-item>
+            <v-text-field v-model="uri" label="URI"></v-text-field>
+          </v-list-item>
+          <v-card-actions>
+            <v-spacer></v-spacer>
+            <v-btn rounded color="primary" large @click="createNft()">
+              ä½œæˆ
+            </v-btn>
+          </v-card-actions>
+        </v-card>
+      </v-col>
+    </v-row>
  </v-container>
ã€€</template>

ã€€<script>
ã€€import Web3 from "web3";
ã€€export default {
...
+  methods: {
+    async createNft() {
+      const tx = {
+        from: this.web3.eth.defaultAccount,
+        to: this.contractAddress,
+        data: this.nftContract.methods.mint(this.uri).encodeABI(),
+      };
+      try {
+        await window.ethereum.request({
+          method: "eth_sendTransaction",
+          params: [tx],
+        });
+        alert("NFTä½œæˆæˆåŠŸ");
+      } catch (error) {
+        alert("NFTä½œæˆå¤±æ•—");
+      }
+    },
+  },
};
ã€€</script>
```

## NFTä½œæˆã—ã¦ã¿ã‚‹

`localhost:3000`ã‹ã‚‰ã½ã¡ã½ã¡ã™ã‚‹ã€‚

1. ç”»é¢è¡¨ç¤º
![image](https://storage.googleapis.com/zenn-user-upload/86695eafa0a7-20220128.png)

2. ã€Œä½œæˆã€ãƒœã‚¿ãƒ³æŠ¼ä¸‹
3. `Metamask`ã§ã®`Sign`ã‚’æ±‚ã‚ã‚‰ã‚Œã‚‹ã€‚ã€Œç¢ºèªã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ä¸‹ï¼ˆropstenæ®‹é«˜ãŒå¿…è¦ï¼‰
![image](https://storage.googleapis.com/zenn-user-upload/8ee1cb887ff2-20220128.png)

4. ä½œæˆå®Œäº†(ã—ãŸã£ã½ã„
![image](https://storage.googleapis.com/zenn-user-upload/66b2cbb9533f-20220128.png)

## ä½œæˆã—ãŸNFTã‚’ç¢ºèªã—ã¦ã¿ã‚‹

ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸çš„ã«ã¯ä½œæˆå®Œäº†ã—ãŸã£ã½ã„ãŒ
**ã²ã­ãã‚Œè€…ãŸã¡ã¯ã€ä½œæˆã§ããŸã®ã‹ä¿¡ç”¨ã§ããªã„ã¨æ€ã†ã®ã§ã€å®Ÿéš›ã«ã‚¹ãƒã‚³ãƒ³ã«å•ã„åˆã‚ã›ã¦ã¿ã‚‹ã€‚**

ä½œæˆã—ãŸã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã§ã¯å–å¾—methodã¯æ›¸ã„ã¦ãªã„ãŒã€ç¶™æ‰¿å…ƒã«å‡¦ç†ãŒæ›¸ã„ã¦ã‚ã‚‹ãŸã‚å–å¾—ã§ãã¾ã™ã€‚
è©³ã—ãçŸ¥ã‚ŠãŸã„äººã¯`openzeppelin`ã®ã‚³ãƒ¼ãƒ‰ã‚’èª­ã‚“ã§ãã ã•ã„ã€‚

```diff sol
async created() {
.....
+    await this.getMyNfts();
  },
  methods: {
+   async getMyNfts() {
+     const myNftCount = await this.nftContract.methods
+      .balanceOf(this.web3.eth.defaultAccount)
+      .call();
+     for (let i = 0; i < myNftCount; i++) {
+      let myNftTokenId = await this.nftContract.methods
+        .tokenOfOwnerByIndex(this.web3.eth.defaultAccount, i)
+        .call();
+      let myNftTokenUri = await this.nftContract.methods
+        .tokenURI(myNftTokenId)
+        .call();
+       console.log("ã‚ãªãŸã®NFT");
+       console.log("tokenId: " + myNftTokenId);
+       console.log("tokenUri: " + myNftTokenUri);
+     }
+   },
    async createNft() {
```

åˆæœŸè¡¨ç¤ºæ™‚ã«ã€tokenã‚’å–å¾—ã—ã«è¡Œãã¨
`æ¤œè¨¼>ã‚³ãƒ³ã‚½ãƒ¼ãƒ«`ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã‚‹ã¯ãšã§ã™ã€‚

![image](https://storage.googleapis.com/zenn-user-upload/cb5e13dcd72a-20220128.png)

ã“ã‚Œã§ãƒ†ã‚¹ãƒˆãƒãƒƒãƒˆã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸç‹¬è‡ªã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’localã®ã‚¢ãƒ—ãƒªã‹ã‚‰å®Ÿè¡Œã—ã€NFTã‚’ä½œæˆã™ã‚‹ã¨ã“ã‚ã¾ã§å®Œäº†ã—ã¾ã—ãŸï¼

## æœ€å¾Œã«

NFTç”Ÿæˆã—ã¦ã¿ã‚‹ã ã‘ãªã‚‰å‰²ã¨ç°¡å˜ã«ã§ãã‚‹ã€‚
ãƒ•ãƒ­ãƒ³ãƒˆã‚¢ãƒ—ãƒªã‹ã‚‰ã‚¹ãƒã‚³ãƒ³å®Ÿè¡Œã™ã‚‹ãªã‚‰ã€ãƒ­ãƒ¼ã‚«ãƒ«ã§é–‹ç™ºã™ã‚‹ã‚ˆã‚Šã‚‚ãƒ†ã‚¹ãƒˆãƒãƒƒãƒˆã«ã‚ã’ã¦é–‹ç™ºã—ãŸæ–¹ãŒä½•ã‹ã¨ä¾¿åˆ©ã ãªãƒ¼ã¨æ€ã„ã¾ã—ãŸã€‚

twitterã®ãƒ•ã‚©ãƒ­ãƒ¼ãŠé¡˜ã„ã—ã¾ã™ï¼
<https://twitter.com/takuya_develop>

ã‚ã¨å®šæœŸçš„ã«æ¸‹è°·ã§ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ã‚‚ãã‚‚ãä¼šã‚„ã‚‹ã®ã§ã€ãœã²å‚åŠ ã—ã¦ãã ã•ã„ã€œã€‚
ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ã«ã¤ã„ã¦èªã‚Šåˆã„ã¾ã—ã‚‡ã†ï¼
<https://block-chain.connpass.com/event/236396/>
